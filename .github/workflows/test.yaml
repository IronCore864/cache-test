name: test

on:
  workflow_dispatch:

permissions: {}

jobs:
  test:
    runs-on: ubuntu-latest  
    steps:
      - name: Adjust Snap cache permissions
        run: |
          sudo mkdir -p /var/lib/snapd/cache
          sudo mkdir -p /var/cache/apt
          sudo chown -R $USER:$USER /var/snap
          sudo chown -R $USER:$USER /var/lib/snapd/cache
          sudo chown -R $USER:$USER /var/cache/apt
          sudo chmod -R a+r /var/snap
          sudo chmod -R a+r /var/lib/snapd/cache
          sudo chmod -R a+r /var/cache/apt
      - uses: actions/cache@v4
        id: snap-cache
        with:
          path: |
            /var/snap
            /var/lib/snapd/cache
          key: ${{ runner.os }}-snapd
      - uses: actions/cache@v4
        id: apt-cache
        with:
          path: /var/cache/apt
          key: ${{ runner.os }}-apt
      - run: sudo apt install -y python3-venv python3-pip
      - run: sudo snap install jq yq
      - run: sudo snap install --classic concierge
      - run: sudo snap install --classic charmcraft
      - name: Adjust Snap cache permissions
        run: |
          sudo chown -R $USER:$USER /var/cache/apt
          sudo chmod -R a+r /var/cache/apt